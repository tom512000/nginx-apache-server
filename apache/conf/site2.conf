# Redirection HTTP vers HTTPS
<VirtualHost *:80>
    ServerName site2.local
    Redirect / https://site2.local:444/
</VirtualHost>

# HTTPS sécurisé + authentification + compression
<VirtualHost *:443>
    ServerName site2.local
    DocumentRoot /var/www/site2

    <Directory /var/www/site2>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        AuthType Basic
        AuthName "Restricted Area"
        AuthUserFile /etc/apache2/.htpasswd
        Require valid-user
    </Directory>

    SSLEngine on
    SSLCertificateFile /etc/ssl/site2/site2.crt
    SSLCertificateKeyFile /etc/ssl/site2/site2.key

    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Content-Security-Policy "default-src 'self';"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

    AddOutputFilterByType DEFLATE text/html text/plain text/xml \
        text/css text/javascript application/javascript application/json \
        application/xml image/svg+xml
    SetEnvIfNoCase Request_URI \
        \.(?:gif|jpe?g|png|ico|zip|gz|bz2|rar|7z|mp4|mp3|avi)$ no-gzip dont-vary
    Header append Vary Accept-Encoding

    ErrorLog ${APACHE_LOG_DIR}/site2_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/site2_ssl_access.log combined
</VirtualHost>
